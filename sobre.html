<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y07NPE5TJ1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Y07NPE5TJ1');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enviar Material - Biblioteca Did√°tica SRE Aragua√≠na</title>
  <meta name="description" content="Envie seus materiais did√°ticos para compor a Biblioteca Did√°tica da SRE Aragua√≠na" />
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PHJlY3QgeD0iMTAiIHk9IjEwIiB3aWR0aD0iODAiIGhlaWdodD0iODAiIGZpbGw9IiMzNDk4ZGIiIHJ4PSI1IiByeT0iNSIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+U1JFPC90ZXh0Pjwvc3ZnPg==" type="image/svg+xml" />
  <style>
    /* Estilos b√°sicos - mantidos do c√≥digo original */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f5f7fa;
    }
    
    .site-header {
      background: linear-gradient(135deg, #2c3e50, #1a2530);
      color: white;
      padding: 1rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .logo img {
      height: 45px;
    }
    
    .brand h1 {
      font-size: 1.8rem;
      margin-bottom: 0.0rem;
    }
    
    .brand p {
      font-size: 1.0rem;
      opacity: 0.8;
    }
    
    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }
    
    .main-nav {
      display: flex;
      margin-top: 1rem;
      overflow-x: auto;
      padding-bottom: 5px;
    }
    
    .main-nav.expanded {
      display: flex;
      flex-direction: column;
      background: transparent;
      width: 100%;
      left: 0;
      top: 100%;
      z-index: 1000;
      padding: 1rem;
    }
    
    .nav-link {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      padding: 0.7rem 1.2rem;
      margin-right: 0.5rem;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .nav-link:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .nav-link.active {
      background: #3498db;
      font-weight: bold;
    }
    
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    
    .content-section {
      background: white;
      border-radius: 8px;
      padding: 2rem;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 2rem;
    }
    
    .hidden {
      display: none;
    }
    
    h2 {
      color: #2c3e50;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #3498db;
    }
    
    h3 {
      color: #2c3e50;
      margin-bottom: 1rem;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 1.5rem;
    }
    
    .btn {
      display: inline-block;
      background: #3498db;
      color: white;
      padding: 0.6rem 1.2rem;
      border-radius: 5px;
      text-decoration: none;
      font-weight: 500;
      transition: background 0.3s ease;
    }
    
    .btn:hover {
      background: #2980b9;
    }
    
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: #95a5a6;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      text-decoration: none;
      margin-bottom: 1.5rem;
      border: none;
      cursor: pointer;
    }
    
    .back-btn:hover {
      background: #7f8c8d;
    }
    
    .site-footer {
      background: #2c3e50;
      color: white;
      text-align: center;
      padding: 2rem 1rem;
      margin-top: 3rem;
    }
    
    .site-footer a {
      color: #3498db;
      text-decoration: none;
      margin-bottom: 1rem;
      display: inline-block;
    }
    
    .site-footer a:hover {
      text-decoration: none;
    }

    /* Estilos espec√≠ficos para a p√°gina de envio */
    .form-intro {
      margin-bottom: 2rem;
      line-height: 1.8;
    }
    
    .form-container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #2c3e50;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: inherit;
      font-size: 1rem;
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .form-required {
      color: #e74c3c;
    }
    
    .form-help {
      font-size: 0.85rem;
      color: #7f8c8d;
      margin-top: 0.3rem;
    }
    
    .form-submit {
      background: #2ecc71;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 5px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .form-submit:hover {
      background: #27ae60;
    }
    
    .form-notice {
      background: #e8f4fc;
      padding: 1.5rem;
      border-radius: 8px;
      margin-top: 2rem;
      border-left: 4px solid #3498db;
    }
    
    .form-notice h3 {
      color: #3498db;
      margin-top: 0;
    }
    
    .form-notice ul {
      margin: 1rem 0;
      padding-left: 1.5rem;
    }
    
    .form-notice li {
      margin-bottom: 0.5rem;
    }
    
    /* Mensagem de agradecimento */
    .thank-you-message {
      text-align: center;
      padding: 3rem 2rem;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
      margin: 2rem auto;
      max-width: 800px;
    }
    
    .thank-you-icon {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      color: #2ecc71;
    }
    
    .thank-you-message h2 {
      color: #2c3e50;
      border-bottom: none;
      margin-bottom: 1rem;
    }
    
    .thank-you-message p {
      font-size: 1.1rem;
      line-height: 1.6;
      margin-bottom: 1.5rem;
      color: #555;
    }

.site-header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1000;
}

/* Espa√ßo no corpo do site para n√£o sobrepor o header */
body {
  padding-top: 90px; /* Desktop */
}

/* Ajuste para telas menores */
@media (max-width: 768px) {
  body {
    padding-top: 80px; /* Mobile, menor espa√ßo */
  }
}

    
    /* Responsividade */
    @media (max-width: 768px) {
      .menu-toggle {
        display: block;
      }
      
      .main-nav:not(.expanded) {
        display: none;
      }
      
      .brand h1 {
        font-size: 1.5rem;
      }
      
      .section-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .main-nav {
        flex-wrap: wrap;
        gap: 5px;
      }
      
      .nav-link {
        margin-bottom: 5px;
      }
      
      .thank-you-message {
        padding: 2rem 1rem;
      }
      
      .thank-you-icon {
        font-size: 3rem;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="logo">
      <img src="img/LogoSRE.png" alt="Logo SRE" />
      <div class="brand">
        <h1>Biblioteca Did√°tica</h1>
        <p>Curr√≠culo, Forma√ß√£o e Avalia√ß√£o</p>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="content-section" id="form-section">
      <a href="index.html" class="back-btn">‚Üê Voltar para a P√°gina Inicial</a>
      
      <h2>Enviar Material Did√°tico</h2>
      
      <div class="form-intro">
        <p>Compartilhe seus materiais did√°ticos conosco! Sua contribui√ß√£o ajudar√° a enriquecer nossa biblioteca e beneficiar outros educadores.</p>
      </div>

      <div class="form-container">
        <form id="material-form" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLScKOziP--1IxlvIDW3q04BZcGGuVGbD2J_AQvMZyxPaDVCC_w/formResponse" method="POST" target="hidden-iframe">
          <div class="form-group">
            <label for="nome" class="form-label">Seu nome <span class="form-required">*</span></label>
            <input type="text" id="nome" name="entry.2130400867" class="form-input" required placeholder="Digite seu nome completo">
          </div>
          
          <div class="form-group">
            <label for="email" class="form-label">Seu e-mail <span class="form-required">*</span></label>
            <input type="email" id="email" name="entry.1564972327" class="form-input" required placeholder="seu@email.com">
            <div class="form-help">Utilizaremos este e-mail apenas para contato sobre seu material</div>
          </div>
          
          <div class="form-group">
            <label for="escola" class="form-label">Escola onde leciona</label>
            <input type="text" id="escola" name="entry.478868593" class="form-input" placeholder="Nome da escola">
          </div>
          
          <div class="form-group">
            <label for="titulo" class="form-label">T√≠tulo do material <span class="form-required">*</span></label>
            <input type="text" id="titulo" name="entry.1963452345" class="form-input" required placeholder="Ex: Atividade de interpreta√ß√£o textual - Poesia">
          </div>
          
          <div class="form-group">
            <label for="area" class="form-label">√Årea do conhecimento <span class="form-required">*</span></label>
            <select id="area" name="entry.1053581000" class="form-select" required>
              <option value="">Selecione uma √°rea</option>
              <option value="Linguagens">Linguagens</option>
              <option value="Matem√°tica">Matem√°tica</option>
              <option value="Ci√™ncias da Natureza">Ci√™ncias da Natureza</option>
              <option value="Ci√™ncias Humanas">Ci√™ncias Humanas</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="componente" class="form-label">Componente curricular <span class="form-required">*</span></label>
            <select id="componente" name="entry.1814252866" class="form-select" required>
              <option value="">Selecione um componente</option>
              <optgroup label="Linguagens">
                <option value="L√≠ngua Portuguesa">L√≠ngua Portuguesa</option>
                <option value="L√≠ngua Inglesa">L√≠ngua Inglesa</option>
                <option value="Espanhol">Espanhol</option>
                <option value="Artes">Artes</option>
                <option value="Educa√ß√£o F√≠sica">Educa√ß√£o F√≠sica</option>
              </optgroup>
              <optgroup label="Matem√°tica">
                <option value="Matem√°tica">Matem√°tica</option>
              </optgroup>
              <optgroup label="Ci√™ncias da Natureza">
                <option value="Biologia">Biologia</option>
                <option value="F√≠sica">F√≠sica</option>
                <option value="Qu√≠mica">Qu√≠mica</option>
              </optgroup>
              <optgroup label="Ci√™ncias Humanas">
                <option value="Hist√≥ria">Hist√≥ria</option>
                <option value="Geografia">Geografia</option>
                <option value="Filosofia">Filosofia</option>
                <option value="Sociologia">Sociologia</option>
              </optgroup>
            </select>
          </div>
          
          <div class="form-group">
            <label for="nivel" class="form-label">N√≠vel de ensino</label>
            <select id="nivel" name="entry.1978375963" class="form-select">
              <option value="">Selecione um n√≠vel</option>
              <option value="Ensino Fundamental - Anos Iniciais">Ensino Fundamental - Anos Iniciais</option>
              <option value="Ensino Fundamental - Anos Finais">Ensino Fundamental - Anos Finais</option>
              <option value="Ensino M√©dio">Ensino M√©dio</option>
              <option value="EJA">Educa√ß√£o de Jovens e Adultos (EJA)</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="descricao" class="form-label">Descri√ß√£o do material <span class="form-required">*</span></label>
            <textarea id="descricao" name="entry.439679751" class="form-textarea" required placeholder="Descreva o conte√∫do, objetivos e como pode ser utilizado..."></textarea>
            <div class="form-help">Inclua informa√ß√µes como: objetivos de aprendizagem, habilidades trabalhadas, tempo estimado de aplica√ß√£o, etc.</div>
          </div>
          
          <div class="form-group">
              <label for="file-upload" class="form-label">Envie o arquivo <span class="form-required">*</span></label>
              <button type="button" id="login-btn" class="btn" style="background:#fbbc05; color:#000;">üîë Conectar ao Google Drive</button>
<input type="file" id="file-upload" class="form-input" required>
              <input type="hidden" id="drive-link" name="entry.15571209">
         <div class="form-help">O arquivo ser√° enviado automaticamente para ser avaliado.</div>
         </div>
          
          <div class="form-group">
            <label class="form-label">Tipo de licen√ßa</label>
            <div>
              <label>
                <input type="radio" name="entry.1870514395" value="Creative Commons" checked> 
                Creative Commons (Permitimos compartilhamento e adapta√ß√£o)
              </label>
            </div>
          </div>
          
          <button type="submit" id="submit-btn" class="form-submit" disabled>Enviar Material</button>
        </form>
        
        
<div id="upload-progress" style="display:none; margin: 1rem 0; padding: 1rem; background:#e8f4fc; border:1px solid #3498db; border-radius:5px; text-align:center; color:#2c3e50;">
  ‚è≥ Enviando arquivo... aguarde.
</div>

        <div class="form-notice">
          <h3>Antes de enviar, verifique se:</h3>
          <ul>
            <li>O material √© de sua autoria ou tem autoriza√ß√£o para compartilhamento</li>
            <li>O link de acesso est√° configurado corretamente para visualiza√ß√£o</li>
            <li>As informa√ß√µes fornecidas est√£o completas e claras</li>
            <li>O conte√∫do est√° adequado para uso educacional</li>
          </ul>
          <p><strong>Aten√ß√£o:</strong> Todos os materiais ser√£o avaliados pela nossa equipe antes de serem publicados.</p>
        </div>
      </div>
    </section>

    <!-- Mensagem de agradecimento (inicialmente oculta) -->
    <section id="thank-you-section" class="thank-you-message hidden">
      <div class="thank-you-icon">‚úÖ</div>
      <h2>Obrigado pelo envio!</h2>
      <p>Sua contribui√ß√£o √© muito valiosa para nossa comunidade educacional. Seu material ser√° avaliado pela nossa equipe e em breve estar√° dispon√≠vel na biblioteca.</p>
      <a href="index.html" class="btn">Voltar √† Biblioteca</a>
      <a href="compartilhar.html" class="btn" style="background-color: #95a5a6;">Enviar outro material</a>
    </section>
  </main>

  <footer class="site-footer">
    <a class="nav-link" href="index.html">Voltar √† Biblioteca</a>
    <a class="nav-link" href="sobre.html">Sobre N√≥s</a>
    <p>SRE Aragua√≠na ¬© 2025 - Curr√≠culo, Forma√ß√£o e Avalia√ß√£o - por Guilherme S. Vanderley</p>
  </footer>

  <!-- Iframe oculto para envio do formul√°rio -->
  <iframe name="hidden-iframe" id="hidden-iframe" class="hidden"></iframe>


    <!-- Google APIs -->
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
  
  <script>
    // === Menu Mobile ===
    function setupMenuToggle() {
      const toggle = document.querySelector('.menu-toggle');
      const mainNav = document.querySelector('.main-nav');
      if (!toggle || !mainNav) return;
      function closeMenu() {
        mainNav.classList.remove('expanded');
        toggle.setAttribute('aria-expanded', 'false');
      }
      toggle.addEventListener('click', (e) => {
        e.stopPropagation();
        mainNav.classList.toggle('expanded');
        toggle.setAttribute('aria-expanded', mainNav.classList.contains('expanded'));
      });
      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 768 && 
            !e.target.closest('.main-nav') && 
            !e.target.closest('.menu-toggle')) {
          closeMenu();
        }
      });
    }

    // === Form / Thank-you ===
    function setupFormSubmission() {
      const form = document.getElementById('material-form');
      const formSection = document.getElementById('form-section');
      const thankYouSection = document.getElementById('thank-you-section');
      const iframe = document.getElementById('hidden-iframe');
      if (!form) return;

      iframe.addEventListener('load', function() {
        // Mostra a mensagem de agradecimento e oculta o formul√°rio
        formSection.classList.add('hidden');
        thankYouSection.classList.remove('hidden');
        thankYouSection.scrollIntoView({ behavior: 'smooth' });
      });

      form.addEventListener('submit', function(e) {
        const submitBtn = document.getElementById('submit-btn');
        submitBtn.disabled = true;

        // valida√ß√£o simples
        const requiredFields = form.querySelectorAll('[required]');
        let valid = true;
        requiredFields.forEach(field => {
          if (!field.value || !String(field.value).trim()) {
            valid = false;
            field.style.borderColor = '#e74c3c';
          } else {
            field.style.borderColor = '';
          }
        });

        // impede envio se o link do drive n√£o estiver pronto
        const driveLink = document.getElementById('drive-link').value.trim();
        if (!driveLink) {
          valid = false;
          alert('Envie o arquivo primeiro. O link do Drive ainda n√£o foi gerado.');
        }

        if (!valid) {
          e.preventDefault();
          submitBtn.disabled = false;
        }
      });
    }

    // === Google Identity Services + Drive Upload ===
    const CLIENT_ID = "302519386482-gcui08mb718dr75ni38nogtv4bb29b7u.apps.googleusercontent.com"; // <-- SUBSTITUA por seu Client ID (OAuth 2.0 Web)
    const SCOPES = "https://www.googleapis.com/auth/drive.file";

    let tokenClient = null;
    let accessToken = null;

    function initClient() {
      if (tokenClient) return tokenClient;
      if (!(window.google && google.accounts && google.accounts.oauth2)) return null;
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: (tokenResponse) => {
          if (tokenResponse && tokenResponse.access_token) {
            accessToken = tokenResponse.access_token;
            console.log('Autenticado.');
          }
        },
      });
      return tokenClient;
    }

    function waitForGIS(maxMs = 10000, step = 100) {
      return new Promise((resolve, reject) => {
        const start = Date.now();
        (function poll(){
          if (window.google && google.accounts && google.accounts.oauth2) return resolve();
          if (Date.now() - start > maxMs) return reject(new Error('Google Identity Services n√£o carregou.'));
          setTimeout(poll, step);
        })();
      });
    }

    async function ensureAccessToken() {
      if (accessToken) return accessToken;
      if (!tokenClient) {
        await waitForGIS();
        initClient();
      }
      return new Promise((resolve, reject) => {
        tokenClient.callback = (tokenResponse) => {
          if (tokenResponse && tokenResponse.access_token) {
            accessToken = tokenResponse.access_token;
            resolve(accessToken);
          } else {
            reject(new Error('Falha ao obter token de acesso.'));
          }
        };
        try {
          tokenClient.requestAccessToken({ prompt: "" });
        } catch (e) {
          // Tenta com prompt expl√≠cito
          try {
            tokenClient.requestAccessToken({ prompt: "consent" });
          } catch (err) {
            reject(err);
          }
        }
      });
    }

    async function handleFileUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      const progressDiv = document.getElementById("upload-progress");
      progressDiv.style.display = "block";
      progressDiv.textContent = "‚è≥ Preparando autoriza√ß√£o...";

      try {
        await ensureAccessToken();
        progressDiv.textContent = "‚è≥ Enviando arquivo... aguarde.";

        const fileMetadata = { name: file.name };
        const formData = new FormData();
        formData.append("metadata", new Blob([JSON.stringify(fileMetadata)], { type: "application/json" }));
        formData.append("file", file);

        // Upload para o Drive
        const uploadResp = await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart", {
          method: "POST",
          headers: new Headers({ "Authorization": "Bearer " + accessToken }),
          body: formData
        });

        if (!uploadResp.ok) {
          const errText = await uploadResp.text();
          throw new Error("Falha no upload: " + errText);
        }

        const fileData = await uploadResp.json();

        // Define permiss√£o p√∫blica (leitura)
        const permResp = await fetch(`https://www.googleapis.com/drive/v3/files/${fileData.id}/permissions`, {
          method: "POST",
          headers: new Headers({
            "Authorization": "Bearer " + accessToken,
            "Content-Type": "application/json"
          }),
          body: JSON.stringify({ role: "reader", type: "anyone" })
        });

        if (!permResp.ok) {
          const errText = await permResp.text();
          throw new Error("Falha ao definir permiss√£o: " + errText);
        }

        const link = `https://drive.google.com/file/d/${fileData.id}/view?usp=sharing`;
        document.getElementById("drive-link").value = link;

        progressDiv.textContent = "‚úÖ Upload conclu√≠do!";
        setTimeout(() => { progressDiv.style.display = "none"; }, 2000);

        document.getElementById("submit-btn").disabled = false;
        alert("Arquivo enviado com sucesso! Agora voc√™ pode enviar o formul√°rio.");
      } catch (err) {
        console.error(err);
        progressDiv.textContent = "‚ö†Ô∏è Erro: " + (err && err.message ? err.message : "Falha durante o upload.");
        document.getElementById("submit-btn").disabled = true;
      }
    }

    // === Boot ===
    document.addEventListener("DOMContentLoaded", async () => {
  setupMenuToggle();
  setupFormSubmission();

  // Bot√£o de login para obter token ANTES do upload
  const loginBtn = document.getElementById("login-btn");
  if (loginBtn) {
    loginBtn.addEventListener("click", async () => {
      try {
        await ensureAccessToken();
        alert("‚úÖ Conectado ao Google Drive!");
        document.getElementById("login-btn").style.display = "none"; // esconde bot√£o depois
        document.getElementById("file-upload").disabled = false;     // libera upload
      } catch (e) {
        alert("Falha ao conectar: " + e.message);
      }
    });
  }

  // Inicia desabilitado at√© login
  const fileInput = document.getElementById("file-upload");
  if (fileInput) {
    fileInput.disabled = true;
    fileInput.addEventListener("change", handleFileUpload);
  }

  try {
    await waitForGIS();
    initClient();
  } catch (e) {
    console.warn(e.message || e);
  }
});</script>
</body>
</html>
